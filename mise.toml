[tools]
python = "3.13"
uv = "latest"
prek = "latest"
gomigrate = "latest"
age = "latest"
fnox = "latest"
"npm:httpyac" = "latest"

[env]
# k2c-agents
ENV = "local"
DATABASE_URL = "postgresql://postgres:password@localhost:4718/k2c_agents?sslmode=disable"
OPENAI_AGENTS_DISABLE_TRACING = "1"
S3_ENDPOINT = "http://localhost:4900"
S3_ACCESS_KEY = "minioadmin"
S3_SECRET_KEY = "minioadmin"
S3_BUCKET = "k2c-agents"
S3_REGION = "us-east-1"
AGENT_INTERVAL_SECONDS = "20"
OPENAI_MODEL = "gpt-5.2"
# k2c-collector
API_ENDPOINT = "http://localhost:8001/event"
CAPTURE_INTERVAL_SECONDS = "10"
IMAGE_FORMAT = "png"
IMAGE_QUALITY = "100"

[tasks."agents.install"]
dir = "{{cwd}}/k2c-agents"
run = "prek install && uv sync"
[tasks."agents.docker-compose.up"]
dir = "{{cwd}}/k2c-agents"
run = "docker-compose up -d"

[tasks."db.migrate"]
dir = "{{cwd}}/k2c-agents"
run = '''
migrate --path ./migrations --database "${DATABASE_URL}" up
'''

[tasks."agents.fmt"]
dir = "{{cwd}}/k2c-agents"
run = "uv run ruff format ."
[tasks."collector.fmt"]
dir = "{{cwd}}/k2c-collector"
run = "uv run ruff format ."

[tasks."collector"]
dir = "{{cwd}}/k2c-collector"
run = '''
uv run python src/__main__.py
'''

[tasks."agents.dev"]
dir = "{{cwd}}/k2c-agents"
depends = [
  "agents.install",
  "agents.preprocess.server",
  "agents.preprocess.manager",
  "agents.evaluation.manager",
  "agents.lead.server",
]

[tasks."agents.preprocess.server"]
dir = "{{cwd}}/k2c-agents"
run = '''
uv run k2c-preprocess-server
'''

[tasks."agents.preprocess.manager"]
dir = "{{cwd}}/k2c-agents"
run = '''
uv run k2c-preprocess-agent
'''

[tasks."agents.evaluation.manager"]
dir = "{{cwd}}/k2c-agents"
run = '''
uv run k2c-eval-agent
'''

[tasks."agents.lead.server"]
dir = "{{cwd}}/k2c-agents"
run = '''
uv run k2c-lead-agent
'''

[tasks."agents.test.http"]
dir = "{{cwd}}/k2c-agents"
run = '''
httpyac send --all ./tests/http/*.http
'''
